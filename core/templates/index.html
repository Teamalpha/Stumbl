{% load staticfiles %}

<!DOCTYPE html>
<html class="no-js">
  <head>
    <title>Stumbl</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="google-site-verification" content="LxRKXxbx-5TCeA5NckaoDS_KytGGYo-N3X4J7rtMd3Q" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.5.1/dist/css/foundation.min.css" integrity="sha256-1mcRjtAxlSjp6XJBgrBeeCORfBp/ppyX4tsvpQVCcpA= sha384-b5S5X654rX3Wo6z5/hnQ4GBmKuIJKMPwrJXn52ypjztlnDK2w9+9hSMBz/asy9Gw sha512-M1VveR2JGzpgWHb0elGqPTltHK3xbvu3Brgjfg4cg5ZNtyyApxw/45yHYsZ/rCVbfoO5MSZxB241wWq642jLtA==" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous" defer></script>
    <script src="https://d3js.org/d3.v5.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.5.1/dist/js/foundation.min.js" integrity="sha256-WUKHnLrIrx8dew//IpSEmPN/NT3DGAEmIePQYIEJLLs= sha384-53StQWuVbn6figscdDC3xV00aYCPEz3srBdV/QGSXw3f19og3Tq2wTRe0vJqRTEO sha512-X9O+2f1ty1rzBJOC8AXBnuNUdyJg0m8xMKmbt9I3Vu/UOWmSg5zG+dtnje4wAZrKtkopz/PEDClHZ1LXx5IeOw==" crossorigin="anonymous" defer></script>
    <script src="{% static 'js/fabric.min.js' %}" defer></script>
    <script src="{% static 'js/fulltilt.min.js' %}" defer></script>
    <script src="{% static 'js/compass.js' %}" defer></script>
    <script src="{% static 'js/app.js' %}" defer></script>

  </head>
  <body>
    <img src="{% static 'images/arrow.svg' %}" id="arrow" class="absolute" alt="Compass arrow">      
    <h1>Welcome to Stumbl</h1>

    <div id='test'></div>
    <div id='alpha'></div>
    <div id='beta'></div>
    <div id='gamma'></div>
    <div id='compass'></div>
    <div id='distance'></div>
    <div id='location'></div>
    <div id='location2'></div>


    <input id="pac-input" class="controls top-layer" type="text" placeholder="choose destination">
    <div class="empty-space"></div>
    <div id="map"></div>
    <div class="empty-space"></div>
    <div id='c-heading'></div>
    <div id='c-bearing'></div>
    <div id='c-finalheading'></div>

    <script>
      var map, infoWindow, destWindow, placeCoords;
      function initAutocomplete() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 35.993, lng: -78.905 },
        zoom: 18,
        disableDefaultUI: true,
        styles: [
          { 
            elementType: 'geometry', 
            stylers: [{ color: '#242f3e' }] 
          },
          { 
            elementType: 'labels.text.stroke',
            stylers: [{ color: '#242f3e' }] 
          },
          { 
            elementType: 'labels.text.fill',
            stylers: [{ color: '#746855' }] 
          },
          {
            featureType: 'administrative.locality',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#d59563' }]
          },
          {
            featureType: 'poi',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#d59563' }]
          },
          {
            featureType: 'poi.park',
            elementType: 'geometry',
            stylers: [{ color: '#263c3f' }]
          },
          {
            featureType: 'poi.park',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#6b9a76' }]
          },
          {
            featureType: 'road',
            elementType: 'geometry',
            stylers: [{ color: '#38414e' }]
          },
          {
            featureType: 'road',
            elementType: 'geometry.stroke',
            stylers: [{ color: '#212a37' }]
          },
          {
            featureType: 'road',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#9ca5b3' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry',
            stylers: [{ color: '#746855' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry.stroke',
            stylers: [{ color: '#1f2835' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#f3d19c' }]
          },
          {
            featureType: 'transit',
            elementType: 'geometry',
            stylers: [{ color: '#2f3948' }]
          },
          {
            featureType: 'transit.station',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#d59563' }]
          },
          {
            featureType: 'water',
            elementType: 'geometry',
            stylers: [{ color: '#17263c' }]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#515c6d' }]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.stroke',
            stylers: [{ color: '#17263c' }]
          }
        ]
      });
      
      var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
        //map.controls[google.maps.ControlPosition.TOP_LEFT].push(input); //

        // Bias the SearchBox results towards current map's viewport.
        map.addListener('bounds_changed', function() {
          searchBox.setBounds(map.getBounds());
        });

        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        searchBox.addListener('places_changed', function() {
          var places = searchBox.getPlaces();
          console.log(places)
          place_lat = places[0].geometry.location.lat()
          place_lng = places[0].geometry.location.lng()
          placeCoords = {lat: place_lat, lng: place_lng}
          place_address = places[0].formatted_address
          place_name = places[0].name
          destWindow = new google.maps.InfoWindow
          destWindow.setPosition({lat: place_lat, lng: place_lng})
          destWindow.setContent(place_name)
          destWindow.open(map)
          map.setCenter({lat: place_lat, lng: place_lng});

          console.log(place_lat, place_lng, place_address, place_name)
          var destination = ({lat: place_lat, lng: place_lng});
          var marker = new google.maps.Marker({
            position: destination,
            map: map,
            icon:"https://img.icons8.com/metro/50/launched-rocket.png",
            animation: google.maps.Animation.BOUNCE,
          });
        });

      infoWindow = new google.maps.InfoWindow;
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          infoWindow.setPosition(pos);
          infoWindow.setContent('You are here');
          infoWindow.open(map);
          map.setCenter(pos);
        }, function () {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        console.log('browser geolocation not supported')
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
      infoWindow.open(map);
    }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&libraries=places&callback=initAutocomplete" async defer></script>
  </body>
</html>