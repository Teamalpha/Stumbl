{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}
  Stumbl - {{ block.super }}
{% endblock title %}

{% block content %}

   
    <img src="{% static 'images/arrow.svg' %}" id="arrow" class="absolute" alt="Compass arrow">      
    <h1>Welcome to Stumbl</h1>
    <input type="hidden" id="pac-input" class="controls top-layer" type="text" placeholder="choose destination">
    <div class="empty-space"></div>
    <div id="map"></div>
    <div class="empty-space"></div>

    {% comment %} Slider for testing compass arrow {% endcomment %}
    <div class="grid-x grid-margin-x">
      <div class="cell small-10">
        <div class="slider" data-slider data-initial-start="360" data-end="360">
          <span class="slider-handle"  data-slider-handle role="slider" tabindex="1" aria-controls="sliderOutput1"></span>
          <span class="slider-fill" data-slider-fill></span>
        </div>
      </div>
      <div class="cell small-2">
        <input type="number" id="sliderOutput1">
      </div>
    </div>

    <script>
      var map, infoWindow;
      function initAutocomplete() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 35.993, lng: -78.905 },
        zoom: 18,
        disableDefaultUI: true,
        styles: [
          { 
            elementType: 'geometry', 
            stylers: [{ color: '#242f3e' }] 
          },
          { 
            elementType: 'labels.text.stroke',
            stylers: [{ color: '#242f3e' }] 
          },
          { 
            elementType: 'labels.text.fill',
            stylers: [{ color: '#746855' }] 
          },
          {
            featureType: 'administrative.locality',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#d59563' }]
          },
          {
            featureType: 'poi',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#d59563' }]
          },
          {
            featureType: 'poi.park',
            elementType: 'geometry',
            stylers: [{ color: '#263c3f' }]
          },
          {
            featureType: 'poi.park',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#6b9a76' }]
          },
          {
            featureType: 'road',
            elementType: 'geometry',
            stylers: [{ color: '#38414e' }]
          },
          {
            featureType: 'road',
            elementType: 'geometry.stroke',
            stylers: [{ color: '#212a37' }]
          },
          {
            featureType: 'road',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#9ca5b3' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry',
            stylers: [{ color: '#746855' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry.stroke',
            stylers: [{ color: '#1f2835' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#f3d19c' }]
          },
          {
            featureType: 'transit',
            elementType: 'geometry',
            stylers: [{ color: '#2f3948' }]
          },
          {
            featureType: 'transit.station',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#d59563' }]
          },
          {
            featureType: 'water',
            elementType: 'geometry',
            stylers: [{ color: '#17263c' }]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#515c6d' }]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.stroke',
            stylers: [{ color: '#17263c' }]
          }
        ]
      });
      
      var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
        //map.controls[google.maps.ControlPosition.TOP_LEFT].push(input); //

        // Bias the SearchBox results towards current map's viewport.
        map.addListener('bounds_changed', function() {
          searchBox.setBounds(map.getBounds());
        });

        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        searchBox.addListener('places_changed', function() {
          var places = searchBox.getPlaces();
          console.log(places)
          place_lat = places[0].geometry.location.lat()
          place_lng = places[0].geometry.location.lng()
          place_address = places[0].formatted_address
          place_name = places[0].name
          console.log(place_lat, place_lng, place_address, place_name)
          var destination = ({lat: place_lat, lng: place_lng});
          var marker = new google.maps.Marker({
            position: destination,
            map: map,
            icon:"https://img.icons8.com/metro/50/launched-rocket.png",
            animation: google.maps.Animation.BOUNCE,
          });
        });

      infoWindow = new google.maps.InfoWindow;
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          infoWindow.setPosition(pos);
          infoWindow.setContent('You are here');
          infoWindow.open(map);
          map.setCenter(pos);
        }, function () {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        console.log('browser geolocation not supported')
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
      infoWindow.open(map);
    }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&libraries=places&callback=initAutocomplete" async defer></script>
  {% endblock content %}
